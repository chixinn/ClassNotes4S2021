#区块链和分享型数据库W3

哈希函数的雪崩效应。c.f.数据结构中哈希函数的不同

http v.s. https：传输以密文传输，即使抓包时被截获也不会影响信息泄漏与否

非对称加密的密钥很难分享；更多它是用来做**签名**的。

签名ensures：

1. 传递过程中没有被篡改
2. 不可否认，这就是用我私钥签过的名，即我是不可抵赖的。

## 哈希v.s.加密？

哈希无法复原；加密虽然以密文的方式传给你了，但我希望你解密(用密钥恢复)。

哈希时没有参数，但加密和解密的时候有密钥。

## 公钥和私钥，验签

公钥多次哈希生成私钥。

![截屏2021-03-16 13.18.58](/Users/chixinning/Library/Application Support/typora-user-images/截屏2021-03-16 13.18.58.png)

##匿名与隐私保护？

私钥是随机生成的

匿名只是具体的人不知道，但仍是可追踪的。比如追踪发起交易的IP地址，比特币系统里仅仅可以做到匿名。

公开透明：每一个节点都有完整的账本

> z-cash可以做到隐私保护而不只是匿名。

比特币系统如果不做处理是完全可追溯的(UTXO模型），直接成为节点以后所有信息就会公开且同步过来。

![截屏2021-03-16 13.30.14](https://tva1.sinaimg.cn/large/e6c9d24ely1golonen4lyj212w0r6x4x.jpg)

## 在UTXO模型里如何避免双花(double-spend)

双花(double-spend)：一笔钱花了两次or多次

只能刷工行卡的超市=》支付宝or微信出现后这个限制就没有了？

支付宝 work as a 可信中介+账户模型。

一个output在两个交易里作为input

被打包到block里，交易才会成功

![截屏2021-03-16 13.40.12](https://tva1.sinaimg.cn/large/e6c9d24ely1goloxvs92wj20pg0ecwny.jpg)

注意第三部这里的第三步交易验证，双花攻击？

## 双花攻击

### 双花攻击case1

每笔交易都需要先确认对应比特币之前的状态，如果它之前已经被标记为花掉，那么新的交易会被拒绝

### 双花攻击case2

如果诈骗者刻意把第一笔交易向一半网络进行广播，把第二笔交易向另一半网络广播

c.f. 分叉

一半传这个网络，一半传另一个网络怎么办呢？

> 但是在两个账本中各只有一笔交易，诈骗者不会有好处。接下来，下一个矿工选择在A基础上继续记账的话，A分支就会比B分支更长，根据区块链的规则，最长的分支会被认可，短的分支会被放弃，账本还是会回归为一个，交易也只有一笔有效;
>
> 矿工总是在本地的最长链上挖矿表示一个认可。
>
> 6个区块以后及往上的区块是不可变的。

### 双花攻击case 3

如果是A分支被认可（B也一样），相应交易确认，拿到商品之后，立刻自己变身矿工，争取到连续两次记账权，然后在B分支上连加两个block，就像这样：

于是B分支成为认可的分支，A被舍弃，A分支中的交易不再成立，但他已经拿到商品，诈骗成功。

>在B分支落后的情况下要强行让它超过A分支，其实是挺难的，假设诈骗者掌握了全网1%的计算能力，那么他争取到记账权的概率就是1%，两次就是10的负4次方。但这个概率还没有太低。
>
>真掌握50%以上，50%算力以上才有可能进行篡改，但这个人如果有这个计算力它也不用靠这个诈骗了，挖矿的收益都更高
>
>POW机制

### 分叉

![截屏2021-03-16 13.44.30](https://tva1.sinaimg.cn/large/e6c9d24ely1golp268gdpj20ta0diadh.jpg)

### 比特币交易

真正交易时有交易所备书

## 矿池，比特大陆

比特币解难题时合起来猜数字?不会更快吗，猜到了以后再分。

## 比特币--分布式账本

![截屏2021-03-16 13.59.49](https://tva1.sinaimg.cn/large/e6c9d24ely1golpi3pvcvj20to0dkjvn.jpg)

所有都是Transaction

### 如何判断交易是否存在

如判断Tx0是否存在，判断Tx-Root是否一样即可。

### 为什么要用默克尔树而非Hash List判断交易是否存在？

![截屏2021-03-16 14.05.16](https://tva1.sinaimg.cn/large/e6c9d24ely1golpnrycegj20km0bwdi4.jpg)

如判断Tx0是否存在，只要判断Hash0-0和Hash1即可，而Hash List是所有

全节点与轻节点(只有区块头)

### 什么时候验证？

1. 作为轻节点才要验证一个交易是否在一个区块里面，只交易但不挖矿。成为了一个SPV节点，它只记录区块头。它需要验证这笔交易是否在区块链网络存在，它就需要跟一个全节点进行交互。
2. 如果是Merkle树的方式，如要验证L3,为了凑topHash，全节点只需要回复这个轻节点L4Hash(1-1)和Hash(0)即可，即是验证。传输量只会变成层高，log以后的结果了

### 比特币中的默克尔验证

![截屏2021-03-16 14.12.00](https://tva1.sinaimg.cn/large/e6c9d24ely1golpv0gcqyj20us0gkgw7.jpg)

数据传输量减少了，计算量是全节点可以临时计算给你(轻节点)，这个计算也不复杂。

但不论是哪一种方式，从全节点到轻节点的数据传输量是对数级的下降。

##    c.f. 默克尔验证 --P2P下载如何保证完整性？

下载时最原始文件有一个哈希，下完整后有一个哈希跟她(最原始)一样就完整。

## 比特币--非可信共识

### 女巫攻击

- RAFT投票系统：一个节点投两票

### BTC如何防止一个节点扮演很多节点呢--POW共识

投票是CPU投票

> 工作量证明机制的本质是一CPU一票，“大多数”的决定表达为 最长的链，因为最长的链包含了最大的工作量。

如果要扮演多个要拿出多个人的算力。

联盟链的投票方式



