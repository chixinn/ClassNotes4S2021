# 区块链与分享型数据库W5

## 分类

### 许可链与非许可链

比特币：非许可链，面对各种攻击，对吞吐要求不高。以太坊：典型的非许可链。

许可链：企业应用，更多的追求的是吞吐。

### 一致性

非许可共识一致性：POW 

联盟/许可链数据一致性：

### 区块链特点

去中心化可追溯不可篡改；去中心化 。使用场景是去中介化：多方参与，互不可信。不可信的场景下如何协作？区块链作为价值互联网的基础设施。

**互不可信**的多方之间构建**可信的**措施。

## 区块链2.0-智能合约

比特币系统是区块链1.0

智能合约：一段业务逻辑/代码：区块数据+状态数据； c.f. (UTXO就像数据库里的日志)

智能合约可以直接访问状态数据

![截屏2021-03-30 13.13.24](https://tva1.sinaimg.cn/large/008eGmZEly1gp1uu5zidjj30qa08o3zp.jpg)

区块链2.0，在此基础上开发应用，业务逻辑以智能合约的方式来写。

### DAPP

去中心化的APP，应用智能合约写DAPP，**数据与业务逻辑**都公开透明。

整个代码的执行过程是自动且不可逆的。

博彩行业中，智能合约应用的很多。![截屏2021-03-30 13.18.00](https://tva1.sinaimg.cn/large/008eGmZEly1gp1uyx6v36j30e606s76g.jpg)

在这里，交易是一次智能合约的调用。

## 从数据管理的角度理解区块链

![截屏2021-03-30 13.21.07](https://tva1.sinaimg.cn/large/008eGmZEly1gp1v25v08gj30km082406.jpg)

拜占庭：有节点有可能会发假消息or作弊。

## 如何保证不可篡改

![截屏2021-03-30 13.22.59](https://tva1.sinaimg.cn/large/008eGmZEly1gp1v43rpy1j30dm08gjsb.jpg)

## 共识算法

![截屏2021-03-30 13.23.28](https://tva1.sinaimg.cn/large/008eGmZEly1gp1v4m25vrj30iy0a2ac1.jpg)

POS：权益证明 proof of steak，持有资产越多的人越会维护整个系统的利益。

## PBFT

许可链下以投票的方式来解决。

## 分布式系统：计算/存储/网络

为了拜占庭容错，数据每个节点都有一份；执行每一个节点也会独立执行，要保证确定性的执行结果一摸一样。

2PL：可串行化，只要并发执行和跟某一串行执行的结果一致。(比如3个，3！个可能，这还是不确定的)

2PC：分布式一致性

那我如何在区块链系统希望并行起来呢?

我们要的不是可串行化，我们要的是确定性，所以可串行化是很难满足要求的。

确定性并发协议：一个log，其它回放log;排序锁。

希望区块在成批交易时并行执行而且还满足确定性，但2PL的协议只能满足可串行化不能满足确定性是不够的。我们一般让一个节点先执行，其它节点回放log，保证一摸一样。

## 以太坊

在公有链里一定要有激励机制，联盟链则无此问题，它靠的是行政命令。

## 以太坊设计原则

- 不歧视
- 不审查

如何避免计算资源的消耗。比如恶意篡改or代码写的不好。

以太币仅仅是驱动智能合约执行所需燃料(gas)的加密令牌,即执行任何一条指令都需要付出一定的gas。

![截屏2021-03-30 13.55.07](https://tva1.sinaimg.cn/large/008eGmZEly1gp1w1m9jayj30ve0kcn3m.jpg)

任何高级语言，图灵完备。

## 1.3 以太坊虚拟机

![截屏2021-03-30 13.56.07](https://tva1.sinaimg.cn/large/008eGmZEly1gp1w2keqz4j30sw0jcjyl.jpg)

Java为什么是跨平台的语言？

EVM肯定也是跨平台的。

在以太坊，随机数不能?

## 特点

![截屏2021-03-30 14.00.45](https://tva1.sinaimg.cn/large/008eGmZEly1gp1w7el8w2j30vm0ewte8.jpg)

## 硬分叉

![截屏2021-03-30 14.05.50](https://tva1.sinaimg.cn/large/008eGmZEly1gp1wcp67b4j30xi0d679d.jpg)













