# 区块链与分享型数据库W2

1. 为什么要发行比特币？

   防止中心化的通货膨胀，比特币是超越主权的货币，因为比特币是每四年减半的。当所有币都挖完了以后，比特币生态如何继续运行下去呢？through 交易费。

2. 去中心化与去中介化？

   E.g.银行跨行转账需要什么？目前所有的跨行转账都会走中国银联(union pay)，即不是实时结账的,是由中国银联做的结算。

   如果中国银联crash了呢？即是P2P去中心化的转账。P2P了以后帐会记载在哪里呢？此时帐只能每个人都去记录了。此时必然要保证每个人的帐是一致的，从数据管理的角度即是分布式一致性协议。

   联盟链的概念由此而生。

## 加密货币-比特币

- 身份管理
- 相应服务
- 交易记录管理
- 信任

### 比特币的密码学基础

密码要**加密**

撞库，密码如果明文存储，密码明文泄露会因为被撞库而信息泄露。

### 加密

1. 对称加密：加密的密钥和解密的密钥是一样的。

   问题：密钥难以传递；

2. 非对称加密：此时有一对密钥，一个叫公钥一个叫私钥，加密的密钥和解密的密钥可以不一样。

   RSA

   公钥：每个人都知道

   好处：密钥分发简单。

3. 对称加密的效率比较高，

用非对称加密的方法传对称加密的私钥，即此时要加密的秘密是那把钥匙。



### 非对称加密：数字签名

![截屏2021-03-09 13.39.54](https://tva1.sinaimg.cn/large/008eGmZEly1godllaf47bj30pw0f4gnn.jpg)

Public key一定是一个合法证书。

Data+签名 由A发给了我，我要确认的有两件事，我要解密，解密后得到了一个消息和原始数据，拿到原始数据后再做哈希，如果和解密的结果是一样的就可以说明：

1. Data没有被恶意篡改
2. 不可否认，这个public key是我发的。

### 比特币身份管理

![截屏2021-03-09 13.48.04](https://tva1.sinaimg.cn/large/008eGmZEly1godltqncf1j30ti092ju2.jpg)

密码学哈希保证了从后往前猜难以返回。 In->out很容易，反过来推不过来。

![截屏2021-03-09 13.51.24](https://tva1.sinaimg.cn/large/008eGmZEly1godlx6mazhj30oa0ecwhq.jpg)

钱包地址只是一个编码，编码不是加密（base 58)这种。

见证交易合法？验签是不可抵赖的。

系统里所有节点都**见证**了这节事情，所以这件事情是不可抵赖的。

## UTXO 未花费的交易输出

![截屏2021-03-09 14.00.03](https://tva1.sinaimg.cn/large/008eGmZEly1godm67bz8wj30oa0c610n.jpg)

UTXO模型中的钱像现金一样。

![截屏2021-03-09 14.03.54](https://tva1.sinaimg.cn/large/008eGmZEly1godma85b2gj30uq0neqrw.jpg)

use1的钱包：5+15+20的钱，单个金额都是不可分割的。

此时T4会有两个输出：（**没有余额的概念，剩下的3快是自己转给自己的）**

1. 输出1:给user2转37
2. 输出2:给user1转3

输出是绑定在地址上的。

![截屏2021-03-09 14.04.53](https://tva1.sinaimg.cn/large/008eGmZEly1godmb8yg2zj30xi0iqk0t.jpg)

![截屏2021-03-09 14.05.25](https://tva1.sinaimg.cn/large/008eGmZEly1godmbs1ipuj30t808q0uu.jpg)

所以这样的交易就相当于是一个网状的结构。

所以比特币是交易可追溯的。

和签名一起打包，所以保证散的“现金”是不可分割的。

没有余额，所有只有utxos。

所以这样每一笔钱都是有记录可以寻找的，即是比特币的隐私保护。

所有的对象都是transaction.

比特币钱包--额外的应用，钱包余额c.f. UTXO的集合

交易被打包成区块。挖矿挖出来第一笔钱，“货币被这样发行”。

![截屏2021-03-09 14.06.39](https://tva1.sinaimg.cn/large/008eGmZEly1godmodav56j307q06y0sw.jpg)

![截屏2021-03-09 14.18.26](https://tva1.sinaimg.cn/large/008eGmZEly1godmpbj0d0j30v20fe41n.jpg)

TransactionID是唯一的

这个不是分布式的，是每个节点都存储了完整的副本



### 交易流程

![截屏2021-03-09 14.19.48](https://tva1.sinaimg.cn/large/008eGmZEly1godmqr0w8mj30pu0f0dlw.jpg)

交易验证：验签；

广播验证结果是以block为单位的；每一个接收到时也要验证是合法的。

是否有交易会永远成功不了？

ICO？c.f.众筹

矿工的收益：1. 挖矿  2.交易费 

矿工会优先选择给他交易费多的交易放到这个block里。

