# 统计与机器学习W2

## Pre

1. $\sum \alpha_i=0$,唯一吗？能替换吗？加约束的目的是使参数估计时具有识别性。

   这a+1个方程并不是都是线性无关的，a 个方程无法估计a+1个参数，所以添加约束使参数可识别了。

   逻辑上，添加与a个方程线性无关即可估计？

   Why $\sum \alpha_i=0$?

2. 从数学上无法解释=》逻辑上解释

   $\sum \alpha_i=0$说明了这个Overall的$\mu$，$\alpha_i$表示因子A处于第i个水平的效应。

   $\sum \alpha_i=0$说明效应和是0，or效应均值是0.

   $a_1=0$，把第一组的均值$\mu_1$当作baseline， 即把某一个水平看做一种参照系，验证其他因子和他之间是否存在差异。

3. $\hat{\sigma^2}=\frac{1}{n-a}SS_e$很重要，是代入计算。无论是原还是H1都成立

4. $\hat{\mu_i}$是什么？

   $\hat{\mu}=\bar{y_{..}},\hat{\alpha_i}=\bar{y_{i.}}-\bar{y_{..}}$

   $\hat{\mu_i}=\hat{\mu}+\hat{\alpha_i}$，由MLE的不变形保证。

   $\hat{\mu_i}=\bar{y_{i.}}$

---

## 点估计-》置信区间

1. $\hat{\mu_i}$的点估计：$\hat{\mu_i}=\bar{y_{i.}}$

2. 点估计的分布:$y_{ij}$~$N(\mu+\alpha_i,\sigma^2)$,i固定时分布是确定的。

   所以$\bar{y_{i.}}=\frac{1}{m}\sum^m_{j=1} y_{ij}$~$N(\mu+\alpha_i,\sigma^2/m)$

3. 标准化$\hat{\mu_i}$～N(0,1)，

   G=标准化$\hat{\mu_i}$，G中会有讨厌因子$\sigma^2$,用讨厌因子的估计取代。

   这里使用$\sigma^2$的估计$\frac{1}{n-a}SS_e$。不用$SS_a$是因为$SS_a$只在$H_0$成立。

   带入后，即可得到$t(n-a)$，$t(n-a)$的构造独立性仍由每个组的均值与方差独立保证。
   $$
   t(n-a)=\frac{\bar{y_{i·}-\mu_i}}{\sqrt{\hat{\sigma^2}/m}}
   $$
   
4. 在置信水平为$1-\alpha$,$p(\theta_1 \le t \le \theta_2)=1-\alpha$,即可。

   所以$\mu_i$的置信区间为

   $\bar{y_{i.}}+-t_{1-\alpha/2}(n-a)\sqrt{\hat{\sigma^2}/m}$

## 模型诊断：判断数据是否符合模型

$y_{ij}=\mu+\alpha_i+,\epsilon_{ij}为N(0,1),i.i.d$

$y_{ij}$～$N(\mu+\alpha_i,\sigma^2)$

1. 观测具有独立性：不是很容易检验（难做）；在**数据收集阶段**介入可能会有独立性检验。

   DW检验试验次序对试验结果的影响，即时序上是相关的还是独立的。

2. 方差齐性，组和组的方差一致。

   Bartlett's Test，常用，对正态性很敏感。

   一般是先跑Bartlett's Test，不满足再Levene Test。

   Levene Test，非参，更稳健

3. 正态性假设：it is robust to the normality assumption. Q图尾部稍微偏移正态。

上面三个条件又强到弱。

正态性的偏移：偏移和厚尾.正态性中怕尾概率难以控制。

> 善于画图

## 数据不是齐性：对数据做变换--$Box-Cox$变换

$Box-Cox$变换前身是幂变换，$Box-Cox$变换相当于幂变换+对数变换。

### 经验法则：

1. 计数数据 Counting Data:先做对数变换。

2. 正数log-normal数据:对数 or 开方$y^*=\sqrt{1+y}$

   log-normal:$x~N(0,1);Y=log(x),Y 为logN(\mu,\sigma^2)$

3. 比率数据 y,区域某个人群占的比率，这个比率是介于(0,1)之间的小数。

   $y^*=arcsin(y)$

### 特殊情况：

如果方差与均值水平有关系，此时方差齐性就不满足了。

股票数据：收益均值越大，方差越大。期望越大，方差越小？

$\mu=E(y)$表示原始值的期望

$\sigma_y$正比于$\mu^{\alpha}$，表示原始值的标准差

幂变换$y^*=y^{1-\alpha}$

要证变换后的方差和期望无关。

$Var(y^*)=Var(y^{\lambda})=E(y^{\lambda})^2-(E(y^{\lambda}))^2$

$f(y)=y^{\lambda}$从数的角度去看，使用泰勒展开，$f(x)=f(x_0)+\frac{1}{1!}f'(x_0)(x-x_0)+\frac{1}{2!}f^{(2)}(x_0)(x-x_0)^2+O((x-x_0)^2)$

这里看成$y$的$\lambda$次方展开，应用泰勒展开公式。

碰到复杂变量，在统计上技巧是应用其线性组合来表示。

$\mu^{2\lambda+2\alpha-2}=\mu^0$

推得$\lambda=1-\alpha$

在实际数据中如何求$\alpha$?

$\sigma_y$正比于$\mu^{\alpha}$，做log后,$\alpha$从指数上拉下来。$ln(\sigma_y)$=lnc+$\alpha ln(\mu)$

通过描点求斜率得到alpha.

### Box-Cox变换

1. $y(\lambda)=\begin{cases}\frac{y^{\lambda}-1}{\lambda}&&\lambda \neq0\\lny&&\lambda=0\end{cases}$
2. $y(\lambda)=\begin{cases}\frac{(y+\lambda_2)^{\lambda_1}-1}{\lambda_1}&&\lambda \neq0\\ln(y+\lambda_2)&&\lambda=0\end{cases}$

通常为了增加可解释性，一般会用更好算的数。如$\lambda=0.4$,开平方根变化，即$\lambda$近似于0.5，不过如果不追求可解释性也可以直接带进去算。



# Two-way Anova

## 一个例子

化肥 种类+使用量对亩产量的影响。即因素从化肥 种类的单一因素扩展到化肥使用量。

化肥 种类a种，使用量b种，重复m次。判断水稻平均亩产量。a$\times$b$\times$m

|      | 1       | 2       | 3      | 4      | b       |
| ---- | ------- | ------- | ------ | ------ | ------- |
| 1    | m个数据 | m个数据 | 。。。 | 。。。 | m个数据 |
| 2    | m个数据 | 。。。  | 。。。 | 。。。 |         |
| 3    |         | 。。。  | 。。。 | 。。。 |         |
| 4    |         | 。。。  | 。。。 | 。。。 |         |
| a    |         | 。。。  | 。。。 | 。。。 |         |

$y_{ijk},i=1,2,...,a;b=1,2,...,b;k=1,2,3,...,m;n=a\times b\times m$

- i表示因子A取第i个水平
- J表示因子B取第j个水平
- K表示，在因子A取第i个水平和因子B取第j个水平时，第k次重复观测。

## 样本量

$n=a\times b\times m$

实验设计：拥有一个样本量$n'$，$n'<<n$。

最小样本成本得到同样的期望结论。

## 与单因素的最大区别：两个因子产生的因子效应

### 因子效应

因子在取不同的水平时，相应变量(观测值y)所发生的变化

> 效应：因子的变化对响应变量的影响

在单因子时，$y_{ij}=\mu+\alpha_i+\epsilon_{ij}$，因子效应为$\alpha_i$

即相应变量受因子效应的影响。

### From 单一因子效应=》两个因子效应：主效应 /交互效应

单因子不考虑因子之间的相互影响。

#### 例子1

$a=2,b=2,m=1$,这里不从统计的角度考虑

因为只取两个水平，一定一个可以低水平，一个可以高水平。A:(-,+);B:(-,+);

| 水平高低 | A    | B    |
| -------- | ---- | ---- |
| 52       | +    | +    |
| 40       | +    | -    |
| 30       | -    | +    |
| 20       | -    | -    |

如何计算**主效应**？：因子A取高水平，因子B取低水平，响应变量的“差”。

A高：（52+40）/2；A低：（30+20）/2=25；A：46-25=21

同理，B的主效应也可以计算：11

#### 例子2

| 水平高低 | A    | B    |
| -------- | ---- | ---- |
| 12       | +    | +    |
| 50       | +    | -    |
| 40       | -    | +    |
| 20       | -    | -    |

同样的：A：1；B：-9

> 因子B取低水平时，因子A的效应为：30
>
> 因子B取高水平时，因子A的效应为：-28

**上面就称为存在因子A和因子B的交互效应**

### 主效应 v.s. 交互效应

主效应，因子自身的变化对响应变量产生的影响；

交互效应，一个因子会影响（另一个因子的变化对响应变量产生的影响）

c.f. 优惠券+打折两种不同的促销方式一块使用

## 如何识别多因子时的交互效应是否存在？

### 方法1可视化

无交互效应：近似平行(绝对平行) v.s. 相交(交点)

### 方法2回归的角度

交互效应：(-28-30)/2；因子B取高水平时，因子A的效应为：-28 与因子B取高水平时，因子A的效应为：30 

$y=\beta_0+\beta_1x_1+\beta_2x_2+\beta_{12}x_1x_2+\epsilon$;

因子A：$x_1=-1,+1$;$-1$表示低水平，$+1$表示高水平；

因子B：$x_2=-1,+1$;$-1$表示低水平，$+1$表示高水平；

最小二乘估计的方法计算 or 根据推导的效应值书写

Case1:$\hat{\beta_1}=\frac{A的主效应}{2}=21/2$；$\hat{\beta_2}=\frac{B的主效应}{2}=11/2$；$\hat{\beta_{12}}=1/2,\hat{\beta_0}=\frac{全部相加}{2}=29.5$

Case2:$\hat{\beta_1}=\frac{A的主效应}{2}=1/2$；$\hat{\beta_2}=\frac{B的主效应}{2}=-4.5$；$\hat{\beta_{12}}=-14.5,\hat{\beta_0}=\frac{全部相加}{2}=(40+12+20+50)/2$

#### 是否存在交互效应：

可以比较$|\hat{\beta_{12}}|$与$|\hat{\beta_{1}}|$和$|\hat{\beta_{2}}|$相对大小的关系：存在${\beta_{12}}$相对比较小不存在，存在${\beta_{12}}$比较大，存在交互效应。

#### Case2中，$\hat{\beta_1}$比较小，是说$\hat{\beta_1}$可以忽略，是否可以说对效应变量不产生影响。**这个是不对的**

因子A的主效应数值小，但它对B的交互效应产生的影响大，就不能说明该因子对效应变量不产生影响。

因子效应：主效应+交互效应

##### 分层原则

## 模型，假设，方差分析表

### 效应模型

$y_{ijk}=\mu+\alpha_i(主效应)+\beta_j+\gamma_{ij}(\alpha\beta)_{ij}+\epsilon_{ijk}$;$i=1,2,...,a;b=1,2,...,b;k=1,2,3,...,m;n=a\times b\times m$

- 对$\epsilon_{ijk}$提要求：

1. 正态
2. $\mu_{\epsilon}=0$
3. 方差齐性$\sigma^2$
4. i.i.d

即$\epsilon_{ijk}$～i.i.d $N(0,\sigma^2)$

- 约束：
  - $\sum\alpha_i=0,\sum\beta_j=0,$
  - $\sum_i^a(\alpha\beta)_{ij}-\sum_j^b(\alpha\beta)_{ij}=0$，每一行每一列和为0.

### 假设

$H_0:\alpha_1=\alpha_2=\alpha_3=...=\alpha_a=0;H_0:\beta_1=\beta_2=\beta_3=...=\beta_b=0;(\alpha\beta)_{ij}=0,$对于所有$ij$

###如何检验？ 方差分析表

| 来源                        | 平方和 | 自由度              | 均方 | 检验统计量        | P值  |
| --------------------------- | ------ | ------------------- | ---- | ----------------- | ---- |
| A                           | Ssa    | a-1                 |      | Msa/mse;          |      |
| B                           | Ssb    | b-1                 |      | Msa/mse;          |      |
| A和B的交互                  | Ssab   | ab+1-a-b=(a-1)(b-1) |      | Msab/mse;         |      |
| 误差                        | SSE    | ab(m-1);ab个小组    |      | $F(df_{ab},df_e)$ |      |
| 总和（方差目的分为这4部分） |        | n-1                 |      |                   |      |

- $SSt=ssa+ssb+sse+ss_{ab}$
- $SS_T=\sum\sum\sum(y_{ijk}-\bar{y})$
- $\bar{y}=\frac{\sum\sum\sum y_{ijk}}{n}$
- $SS_E=\sum_{ijk}(y_{ijk}-\bar{y_{ij.}})$组和组之间存在差异，每组的误差平方和求和，
- $SS_A=\sum_i(\bar{y_{i..}}-\bar{y})^2$
- $SS_B=\sum_j(\bar{y_{.j.}}-\bar{y})^2$
- $SS_{AB}=\sum(\bar{y_{ij.}}-\bar{y_{i..}}-\bar{y_{.j.}}+\bar{y})^2=(\bar{y_{ij.}}-\bar{y})-(\bar{y}-\bar{y_{i..}})-(\bar{y_{.j.}}-\bar{y})$
- 对于SST往SSA，SSB，SSE分解求SSAB

# 作业

在整个模型

$E(MSA,MSB,MSE,MSAB)$

