# 统计与机器学习Overview

统计更看重数据和模型是否匹配

机器学习更看重预测的精度。

如，在股票中更看重我有没有把股票预测对。

---

# 第一讲 ANOVA(Single Factor Anova)方差分析

Analysis of Variance(AOV)

## RA Fisher 农田试验，deciding which factor可以提高亩产量。

问：探究化肥A,B对水稻的亩产量的影响 c.f. 哪种广告投放效果最好

数据：

- 化肥A :$x_1,x_2,...,x_{10}$
- 化肥B :$y_1,y_2,...,y_{10}$

$H_0:\mu_x=\mu_y$,应用方差不已知时的两样本$t$检验。

$H_1:\mu_x\neq\mu_y$

检验统计量$?$

1. 点估计 ：$\hat{\mu_x}=\bar{x},\hat{\mu_y}=\bar{y}$,如果$\bar{x}$和$\bar{y}$很接近。
2. $\bar{x}-\bar{y}$的分布是什么？$\bar{x}$和$\bar{y}$独立，

> 两样本t和成对数据t

3. 标准化,$\sigma^2$未知，用样本方差$s^2$去代替,即$s^2=\hat{\sigma^2}$

所以得到了在$H_0$成立的情况下的检验统计量:
$$
t=\frac{\bar{x}-\bar{y}}{\sqrt{\frac{2s^2}{n}}},t\in t(2n-2)
$$

4. 确认拒绝域

   { $t_0 \le t_{\alpha/2}(2n-2)$}或{ $t_0 \ge t_{1-\alpha/2}(2n-2)$}

5. 确认p值

   $2P(t\ge|t_0|)$

## Further more:

设市场上有A种化肥$A_1,A_2,....,A_a$,同样的我们可以获得数据。

$a$种化肥，$m$块土地

1. 数据定义
   $$
   \begin{pmatrix}y_{11}&&y_{12}&&y_{1m}\\y_{21}&&y_{22}&&y_{2m}\\y_{i1}&&y_{i2}&&y_{im}\end{pmatrix}
   $$

第一个1表示化肥类型，第2个1表示第几块土地，

- $A_1,A_2,....,A_a$为因子。

- $m$为重复次数
- $y_{1m}$为观测值
- 亩产量为响应变量
- a种因子，取值，因子水平(level of factor)，处理(treatment)

认为第$i$行,$y_{i1},y_{i2},...,y_{im}\in N(\mu_i,\sigma^2)$表示某一个因子(化肥类型）下面的正态分布.

**每一行是iid,行与行之间是独立的。**

### 此时，我们的问题：

$H_0:\mu_0=\mu_1=...=\mu_a$

#### 建模

$y_{ij}=N(\mu_i,\sigma^2)$,$y_{ij}$之间独立

$y_{ij}=\mu_i+\epsilon_{ij}$=确定的+随机的，$\epsilon_{ij}$是独立同分布$N(0,\sigma^2)$

这个模型叫**均值模型**，因为它只对均值做了模型。

这里确定的$\mu$，一部分与$i$有关，一部分无关。$\mu_i=\mu+\alpha_i$,添加一个约束:$\mu=\frac{1}{m}\sum ^m\mu_i$

$\mu_i=\mu+\alpha_i$左右两边同时对i求和，可得$\sum\alpha_i=0$,这个$\sum\alpha_i=0$就是约束

$y_{ij}=\mu_i+\epsilon_{ij}+\alpha_i$

这个模型叫**效率模型(effective model),** **$\alpha_i$即为因子$A_i$的效率，即平均产量之上提升它或降低它的效应。**

此时，我们的假设变为检验$\alpha_i$是否为0.

$H_0:\mu_0=\mu_1=...=\mu_a $等价于$H_0:\alpha_i=0$

1. 如果$H_0$成立，所有样本是同分布的，同一总体。

   $\sum_{i=1}^{a}\sum_{j=1}^m(y_{ij}-\bar{y_{..}})^2$为总偏差平方和$SS_T$

2. 如果$H_0$不成立，所有样本不是同分布的，不同总体。我们去看各组数据的方差分别是什么，并将方差加起来。

   $\sum_{i=1}^{a}\sum_{j=1}^m(y_{ij}-\bar{y_{i.}})^2$为误差平方和$SS_E$

#### 引理

$SS_T=SS_E+SS_A$

$\sum_{i=1}^{a}\sum_{j=1}^m(y_{ij}-\bar{y_{..}})^2=\sum_{i=1}^{a}\sum_{j=1}^m(y_{ij}-\bar{y_{i.}})^2+m\sum_a(\bar{y_{i.}-\bar{y_{..}}})^2$

下面这个思路很重要

在$H_0$成立的情况下，$SS_T$约等于$SS_E$,$SS_A$很接近于0.反之,$SS_A$不会太小，但它一定不会超过$SS_T$

此时我们提出一个新的检验统计量$T=\frac{SS_A}{SS_E}$,若T很大我们认为它不成立。

对于这里的$T$我们要标准化,标准化即除以自由度，所以$T=\frac{SS_A/(a-1)}{SS_E/(a(m-1))}$,$SS_A$的自由度是$a-1$,$SS_E$的自由度是$a(m-1)$

---

## ANOVA-完整思考过程

1. 独立性检验
2. 方差齐性检验
3. 正态性检验

### Model

这两个模型都是有假设的

1. Mean model

   $y_{ij}=\mu_i+\epsilon_{ij}$，$\epsilon_{ij}$是独立同分布$N(0,\sigma^2)$,

   $e_{ij}=y_{ij}-\hat{\mu_{i}}$,$\hat{\mu_{i}}$怎么去估计呢，$\hat{\mu_{i}}=\hat{y_{i·}}$,组内的。

2. Effective model

   $y_{ij}=\mu_i+\epsilon_{ij}+\alpha_i，\sum\alpha_i=0$，不要忘了后面这个约束

   $\epsilon_{ij}$是独立同分布$N(0,\sigma^2)$

   这个$\sigma^2$和上面那个是一样的

### 条件

独立性

$\epsilon_{ij}$是**独立**同分布$N(0,\sigma^2)$，样本里的每一个观测值是独立的。

对误差项提独立性条件，可以观测到的叫**残差**$e_{ij}=y_{ij}-\hat{y_{ij}}$，residuals.

方差齐性(同质)

每组的方差是一致的。

基于假定$y_{ij}$独立$N(\mu,\sigma^2)$

> Bartlett检验:正态性敏感
>
> Levene检验:Robust

正态性检验

qq图

W检验

10个里面，总$\alpha$，每个控制在$\alpha/10$，这个Bonferrnoi校正方法过于保守没有用足。所以有这个不足有一个新的方法$LSD$(多重比较)

# One-Way ANOVA

## One-Way ANOVA模型及其假设（Tuesday)

比较两个总体均值：两样本t=>比较多个总体均值；



## 检验问题及其解决方案

### 数据

$$
\begin{pmatrix}0&&1&&2&&3\\A_1&&y_{11}&&y_{12}&&y_{1m}\\A_2&&y_{21}&&y_{22}&&y_{2m}\\A_3&&y_{i1}&&y_{i2}&&y_{im}\end{pmatrix}
$$

- 样本量n=am

- 均值模型：$y_{ij}=\mu_i+\epsilon_{ij}，i=1,2,...,a;j=1,2,...,m$,这里m与a不同，叫balanced 平衡设计

  $\epsilon_{ij}$～$N(0,\sigma^2)$,iid

- 添加条件$\mu_i=\mu+\alpha_i,\sum\alpha_i=0$;则为效应模型

### 假设

均值$H_0:\mu_0=\mu_1=...=\mu_a $ v.s. $H_1$至少存在$(i,j) s.t. \mu_i\neq\mu_j$

效应$H_0:\alpha_0=\alpha_1=...=\alpha_a=0 $ v.s. $H_1$至少存在$(i,j) s.t. \alpha_i \neq 0$

### 检验统计量的确定

$T=\frac{SS_A/(a-1)}{SS_E/(a(m-1))}$；为什么要除自由度；A是因子个数；SSE的自由度是**每组的偏差平方和(m-1)，a个组。**a(m-1)=am-a=n(样本量)-a;

$SS_T=SS_E+SS_A$是恒等式

在$H_0下,y_{ij}独立同分布，N(\mu,\sigma^2)$，若$H_0$不成立，每一组可以看成1个整体，一共不是1个整体，是a个整体；

$\sum_{i=1}^{a}\sum_{j=1}^m(y_{ij}-\bar{y_{..}})^2=\sum_{i=1}^{a}\sum_{j=1}^m(y_{ij}-\bar{y_{i.}})^2+m\sum_a(\bar{y_{i.}-\bar{y_{..}}})^2$

在$H_0$成立的情况下，$SS_T$约等于$SS_E$,$SS_A$很接近于0.反之,$SS_A$不会太小，但它一定不会超过$SS_T$

### 拒绝域

{$T \ge c$}

###恒等式 证明

左边加一项减一项交叉项为0.

$(\bar{y_{i.}-\bar{y_{..}}})^2$与j无关。

### 【重要定理】如何找到检验统计量分布？,在$H_0$成立的条件下

$T$服从于卡方分布

1. 证明$SS_E/\sigma^2$~$X^2(n-a)$
2. **$H_0$下,$SS_A/\sigma^2$~$X^2(a-1)$**，注意前面那个前提条件。
3. $SS_A$与$SS_E$独立；

c.f. 看成一堆独立的正态分布的方差。【$(n-1)s^2/\sigma^2$】

证明1:

$y_{ij}$独立，服从正态分布$N(\mu+a_i,\sigma^2)$

$\sum^a\sum^m(y_{ij}-\bar{y_{i.}})^2=\sum^a\sum^m_j(\epsilon_{ij}-\bar{\epsilon_{i·}})^2$

$y_{ij}=\mu+\alpha_i+\epsilon_{ij}$

$\bar{y_{i.}}=\frac{1}{m}\sum_j^my_{ij}=\frac{1}{m}\sum_j^m(\mu+\alpha_i+\epsilon_{ij})=\mu+\alpha_i+\bar{\epsilon_{i·}}$

$\bar{y_{..}}=\frac{1}{ma}()=\mu+\sum_i\alpha_i+\bar{\epsilon_{··}}=\mu+\bar{\epsilon_{··}}$

SSE可以看成a个独立$X^2(m-1)$分布随机变量的和

证明2:SSA

SSA=$\sum_i^a\sum^m_j(\bar{y_{i·}}-\bar{y_{··}})^2$

交叉项在计算是消不掉的，可以从求期望或在原假设成立的情况下考虑。

在$H_0$下，所有$\alpha_i=0$

$SSA=m\sum_i^a(\bar{\epsilon_{i·}}-\bar{\epsilon_{··}})^2$，也是随机变量-样本均值。

$\bar{\epsilon_{i·}}$怎么看成随机变量呢，即验证它的独立性；对每组而言独立还是存在的。

或者这样理解本身有am=n个独立样本，分成a组，组和组之间还是独立的。

$\bar{\epsilon_{i·}}$～$N(0,\sigma^2/m)$

$\bar{\epsilon_{··}}$怎么看成样本均值呢？看成先分组的每组的均值。

$\bar{\epsilon_{··}}=\frac{1}{am}\sum\sum()=\frac{1}{a}\sum$

证明3:独立性

$SSA$:$\bar{\epsilon_{i·}}$的函数

$SSE$:$\bar{\epsilon_{i·}}$的方差的函数$\sum^m(\epsilon_{ij}-\bar{\epsilon_{i·}})^2$【存疑问】

### 检验

$W={F_0\ge F_{1-\alpha}(a-1,n-a)}$

### 引理:Cochran's Theorem

令$z_i$独立同分布于$N(0,1)$；且$\sum^v_{i=1} z_i^2=Q_1+Q_2+....+Q_s,s\le v$;$Q_i$的自由度$v_i,i=1,...,s$

于是$Q_1,Q_2,...,Q_s$相互独立的随机变量且$Q_i$～$X^2(v_i)$;$v=v_1+v_2+...+v_s$

SST整个样本的偏差平方和，是$X^2(n-1)$;

SSE$X^2(n-a)$

SSA$X^2(a-1)，$在原假设成立的情况下。

### ANAVO表

| 来源    | 平方和SS | 自由度 | 均方          | 检验统计量F   | P值                                                          |
| ------- | -------- | ------ | ------------- | ------------- | ------------------------------------------------------------ |
| 因子(A) | SSA      | a-1    | MSA=ssa/(a-1) | $F_0$=MSA/MSE | $p=P(F\ge F_0)$                                              |
| 误差    | SSE      | n-a    | MSE=ssa/(n-a) |               | F是服从F分布且自由度为a-1,n-a的**随机变量**；F_0是样本计算可得 |
| 总和    | SST      | n-1    |               |               |                                                              |

###  新问题：效应的分类

将$\mu_i$看成参数的后果是什么？

$y_{ij}=\mu_i+\epsilon_{ij}+\alpha_i$

将$\alpha_i$看成未知参数 or随机变量？

将$\alpha_i$看成未知参数 ，是考虑$\alpha_1=\alpha_2=\alpha_3=0$,固定效应模型；

将$\alpha_i$看成随机变量：$\alpha_i$则是众多因子里的样本。普陀区千千万学校找3个寻找差异；

$\alpha_i$～$N(0,\sigma_{\alpha}^2)$，是随机效应模型(Random effect)；

## 模型中参数估计的方法

1. $\mu_i;\mu_i$的估计
2. $\alpha_i$的估计
3. $\sigma^2$的估计

待估参数：a+2个

MLE估计参数

MLE=$\Pi^a\Pi^mf(y_{ij})$

$\hat{\mu}=\bar{y_{··}}$

$\hat{\alpha_i}=\bar{y_{i·}}-\bar{y_{··}}$

$\hat{\sigma_M}=\frac{1}{n}\sum\sum(y_{ij}-\hat{y_{i·}})^2=\frac{1}{n}SSE$SSE 是卡方分布，期望好求，不无偏

所以，$\hat{\sigma^2}=\frac{1}{n-a}SSE$

## 模型诊断及数据变换

平衡设计和不平衡设计。每一个因子水平做了$m_i$次试验。

